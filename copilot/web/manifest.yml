# copilot/web/manifest.yml
name: web
type: Load Balanced Web Service

http:
  path: "/"
  #alias:
  # - tasks.joshuascutts.com
  #certificates:
  # - arn:aws:acm:ap-southeast-2:427004120763:certificate/3c65de84-38f1-42de-8f93-46c9e7df944f
  # healthcheck: "/"   # optional
  #redirect_to_https: true

image:
  build:
    dockerfile: ./Dockerfile
    context: .
  port: 1337

cpu: 256
memory: 512
count: 1
exec: true

variables:
  BASE_URL: https://tasks.joshuascutts.com
  TRUST_PROXY: "true"
  PGSSLMODE: require
  PGSSLROOTCERT: /app/certs/rds-bundle.pem
  NODE_EXTRA_CA_CERTS: /app/certs/rds-bundle.pem
  KNEX_REJECT_UNAUTHORIZED_SSL_CERTIFICATE: "false"
  NODE_ENV: production

  SMTP_HOST: smtp.mailgun.org
  SMTP_PORT: "587"           # use "465" if you prefer implicit TLS
  SMTP_SECURE: "false"       # "true" if using port 465
  SMTP_FROM: "Tasks <josh@joshuascutts.com>"   # From address must be on a Mailgun-verified domain
  SMTP_NAME: "tasks.joshuascutts.com"          # optional EHLO/HELO name

  # If your image has the RDS bundle baked in, you can also add:
  # NODE_EXTRA_CA_CERTS: /app/certs/rds-global-bundle.pem
  # PGSSLROOTCERT: /app/certs/rds-global-bundle.pem

secrets:
  DATABASE_URL: /copilot/planka/prod/secrets/DATABASE_URL
  SECRET_KEY:   /copilot/planka/prod/secrets/SECRET_KEY
  SMTP_USER: /copilot/planka/prod/secrets/SMTP_USER
  SMTP_PASSWORD: /copilot/planka/prod/secrets/SMTP_PASSWORD
